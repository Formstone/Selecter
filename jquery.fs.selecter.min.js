/*
 * Selecter Plugin [Formstone Library]
 * @author Ben Plum
 * @version 1.9.4
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery){(function(h){var k=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test((navigator.userAgent||navigator.vendor||window.opera));var d={callback:function(){},cover:false,customClass:"",defaultLabel:false,links:false,trimOptions:false,externalLinks:false};var q=0;var r={defaults:function(u){d=h.extend(d,u||{});return h(this)},disable:function(){var y=h(this);for(var w=0,x=y.length;w<x;w++){var v=y.eq(w);var u=v.next(".selecter");if(u.hasClass("open")){u.find(".selecter-selected").trigger("click")}v.attr("disabled","disabled");u.addClass("disabled")}return y},enable:function(){var y=h(this);for(var w=0,x=y.length;w<x;w++){var v=y.eq(w);var u=v.next(".selecter");v.attr("disabled",null);u.removeClass("disabled")}return y},destroy:function(){var y=h(this);for(var w=0,x=y.length;w<x;w++){var v=y.eq(w);var u=v.next(".selecter");if(u.hasClass("open")){u.find(".selecter-selected").trigger("click")}if(h.fn.scroller!=undefined){u.find(".selecter-options").scroller("destroy")}v.off(".selecter").removeClass("selecter-element").show();u.off(".selecter").remove()}return y}};function m(x){x=x||{};var v=h.extend({},d,x);var y=h(this);for(var u=0,w=y.length;u<w;u++){f(y.eq(u),v)}return y}function f(H,u){if(!H.data("selecter")){var v=H.find("option, optgroup"),I=v.filter("option"),G=I.filter(":selected"),F=(u.defaultLabel)?-1:I.index(G),J=v.length-1,z=(u.links)?"nav":"div",w=(u.links)?"a":"span";u.multiple=H.attr("multiple")=="multiple";u.disabled=H.is(":disabled");var D="<"+z+' class="selecter '+u.customClass;if(o){D+=" mobile"}else{if(u.cover){D+=" cover"}}if(u.multiple){D+=" multiple"}else{D+=" closed"}if(u.disabled){D+=" disabled"}D+='">';if(!u.multiple){D+='<span class="selecter-selected">';D+=j(u.trimOptions,((u.defaultLabel!=false)?u.defaultLabel:G.text()));D+="</span>"}D+='<div class="selecter-options">';var y=0;var x=null;for(var C=0,E=v.length;C<E;C++){x=h(v[C]);if(x[0].tagName=="OPTGROUP"){D+='<span class="selecter-group">'+x.attr("label")+"</span>"}else{D+="<"+w+' class="selecter-item';if(x.is(":selected")){D+=" selected"}if(C==0){D+=" first"}if(C==J){D+=" last"}D+='" ';if(u.links){D+='href="'+x.val()+'"'}else{D+='data-value="'+x.val()+'"'}D+=">"+j(u.trimOptions,x.text())+"</"+w+">";y++}}D+="</div>";D+="</"+z+">";H.addClass("selecter-element").after(D);var B=H.next(".selecter");var A=h.extend({$selectEl:H,$optionEls:I,$selecter:B,$selected:B.find(".selecter-selected"),$itemsWrapper:B.find(".selecter-options"),$items:B.find(".selecter-item"),index:F,guid:q},u);if(h.fn.scroller!=undefined){A.$itemsWrapper.scroller()}B.on("click.selecter",".selecter-selected",A,g).on("click.selecter",".selecter-item",A,a).on("selecter-close",A,c).data("selecter",A);if((!u.links&&!o)||o){H.on("change",A,t).on("blur.selecter",A,l);if(!o){H.on("focus.selecter",A,e)}}else{H.hide()}q++}}function g(x){x.preventDefault();x.stopPropagation();var w=x.data;if(!w.$selectEl.is(":disabled")){h(".selecter").not(w.$selecter).trigger("selecter-close",[w]);if(o){var v=w.$selectEl[0];if(document.createEvent){var u=document.createEvent("MouseEvents");u.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);v.dispatchEvent(u)}else{if(element.fireEvent){v.fireEvent("onmousedown")}}}else{if(w.$selecter.hasClass("closed")){b(x)}else{if(w.$selecter.hasClass("open")){c(x)}}}}}function b(x){x.preventDefault();x.stopPropagation();var w=x.data;if(!w.$selecter.hasClass("open")){var u=w.$selecter.offset();var y=h("body").outerHeight();var v=w.$itemsWrapper.outerHeight(true);if(u.top+v>y&&o){w.$selecter.addClass("bottom")}else{w.$selecter.removeClass("bottom")}w.$itemsWrapper.show();w.$selecter.removeClass("closed").addClass("open");h("body").on("click.selecter-"+w.guid,":not(.selecter-options)",w,n);if(h.fn.scroller!=undefined){w.$itemsWrapper.scroller("reset")}}}function c(v){v.preventDefault();v.stopPropagation();var u=v.data;if(u.$selecter.hasClass("open")){u.$itemsWrapper.hide();u.$selecter.removeClass("open").addClass("closed");h("body").off(".selecter-"+u.guid)}}function n(u){u.preventDefault();u.stopPropagation();if(h(u.currentTarget).parents(".selecter").length==0){c(u)}}function a(y){y.preventDefault();y.stopPropagation();var u=h(this);var x=y.data;if(!x.$selectEl.is(":disabled")){if(x.links){var v=u.attr("href");if(x.externalLinks){window.open(v)}else{window.location.href=v}}else{if(x.$itemsWrapper.is(":visible")){var w=x.$items.index(u);s(w,x,false)}}if(!x.multiple){c(y)}}}function t(y,v){if(!v){var u=h(this),x=y.data;console.log(y);if(x.links){window.location=u.val()}else{var w=x.$optionEls.index(x.$optionEls.filter("[value="+u.val()+"]"));s(w,x,false)}}}function e(v){v.preventDefault();v.stopPropagation();var u=v.data;if(!u.$selectEl.is(":disabled")&&!u.multiple){u.$selecter.addClass("focus");h(".selecter").not(u.$selecter).trigger("selecter-close",[u]);h("body").on("keydown.selecter-"+u.guid,u,p)}}function l(v){v.preventDefault();v.stopPropagation();var u=v.data;u.$selecter.removeClass("focus");h(".selecter").not(u.$selecter).trigger("selecter-close",[u]);h("body").off(".selecter-"+u.guid)}function p(z){if(z.keyCode!=9&&(!z.metaKey&&!z.altKey&&!z.ctrlKey&&!z.shiftKey)){z.preventDefault();z.stopPropagation();var y=z.data;var x=y.$items.length-1;var v=-1;if(h.inArray(z.keyCode,(k)?[38,40,37,39]:[38,40])>-1){v=y.index+((z.keyCode==38||(k&&z.keyCode==37))?-1:1);if(v<0){v=0}if(v>x){v=x}}else{var u=String.fromCharCode(z.keyCode).toUpperCase();for(i=y.index+1;i<=x;i++){var w=y.$optionEls.eq(i).text().charAt(0).toUpperCase();if(w==u){v=i;break}}if(v<0){for(i=0;i<=x;i++){var w=y.$optionEls.eq(i).text().charAt(0).toUpperCase();if(w==u){v=i;break}}}}if(v>=0){s(v,y,true)}return false}}function s(w,y,v){var u=y.$items.eq(w);if(!u.hasClass("selected")){var x=u.html();var z=u.data("value");if(y.multiple){y.$optionEls.eq(w).attr("selected","selected")}else{y.$selected.html(x);y.$items.filter(".selected").removeClass("selected");if(!v||(v&&!k)){y.$selectEl[0].selectedIndex=w}}y.$selectEl.trigger("change",[true]);u.addClass("selected");y.callback.call(y.$selecter,y.$selectEl.val());y.index=w}else{if(y.multiple){y.$optionEls.eq(w).attr("selected",null);u.removeClass("selected")}}}function j(u,v){if(u===false){return v}else{if(v.length>u){return v.substring(0,u)+"..."}else{return v}}}h.fn.selecter=function(u){if(r[u]){return r[u].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof u==="object"||!u){return m.apply(this,arguments)}}return this}})(jQuery)};